# PRD: V2 战斗系统视觉升级

## Introduction

优化 V2 战斗系统的视觉体验，包括调整角色/敌人位置以展示完整战斗场面，以及添加火球攻击动画增强答题正确时的反馈感。目标是在不遮挡核心 UI 的前提下，让战斗更加生动有趣。

## Goals

- 调整英雄和怪物位置，在 iPad 竖屏模式下展示完整战斗场面
- 确保角色不遮挡田字格、按钮等核心 UI 元素
- 添加卡通风格火球攻击动画，增强正确答题的成就感
- 动画时长适中（0.5-1秒），不打断游戏节奏

## User Stories

### US-001: 调整战斗区域布局
**Description:** 作为玩家，我希望能看到完整的战斗场面，角色和敌人位置合理，不会被 UI 遮挡或显示在屏幕边缘外。

**Acceptance Criteria:**
- [ ] 英雄角色完整显示在屏幕左侧，不被田字格遮挡
- [ ] 怪物完整显示在屏幕右上方，不超出屏幕边界
- [ ] 战斗区域与书写区域有清晰的视觉分隔
- [ ] iPad 竖屏模式下布局美观协调
- [ ] 横屏模式下同样正常显示（可适当调整）
- [ ] Typecheck 通过

### US-002: 创建火球精灵图片
**Description:** 作为开发者，我需要一个卡通风格的火球图片素材用于攻击动画。

**Acceptance Criteria:**
- [ ] 火球图片为卡通可爱风格，与现有角色风格一致
- [ ] 图片为 PNG 格式，带透明背景
- [ ] 尺寸适中（建议 128x128 或 256x256）
- [ ] 保存至 `assets/images/fireball.png`

### US-003: 实现火球飞行动画
**Description:** 作为玩家，当我写对汉字时，我希望看到英雄发射火球攻击怪物，让我感受到"攻击成功"的反馈。

**Acceptance Criteria:**
- [ ] 答题正确时触发火球动画
- [ ] 火球从英雄位置发出，直线飞向怪物位置
- [ ] 动画时长 0.5-1 秒
- [ ] 火球命中后消失
- [ ] 动画期间不影响后续操作（动画结束后再进行伤害结算）
- [ ] Typecheck 通过

### US-004: 火球命中效果
**Description:** 作为玩家，我希望火球命中怪物时有明显的视觉反馈。

**Acceptance Criteria:**
- [ ] 火球到达怪物位置时消失
- [ ] 可选：命中时播放简单的闪烁或缩放效果
- [ ] 命中后正常执行怪物扣血逻辑
- [ ] 音效（已有 hit 音效）在命中时播放
- [ ] Typecheck 通过

## Functional Requirements

- FR-1: 重新计算英雄位置，使其位于屏幕左下区域，完整可见且不遮挡田字格
- FR-2: 重新计算怪物位置，使其位于屏幕右上区域，完整可见
- FR-3: 战斗区域（gameArea）高度比例优化，给角色足够展示空间
- FR-4: 创建 `Fireball` 动画组件，使用 `Animated` API 实现位置移动
- FR-5: 火球起点为英雄中心位置，终点为怪物中心位置
- FR-6: 动画使用 `Animated.timing` 配合 `easing` 实现平滑移动
- FR-7: 在 `handleResult(true)` 流程中插入火球动画，动画完成后再执行伤害结算
- FR-8: 火球动画期间禁用书写输入，防止重复触发

## Non-Goals

- 不实现火球拖尾粒子效果
- 不实现复杂的命中爆炸动画
- 不实现怪物受击抖动效果
- 不实现多种攻击类型（只有火球）
- 不修改怪物移动逻辑

## Technical Considerations

- 使用 React Native `Animated` API 实现动画
- 火球位置需要根据当前英雄和怪物的实际位置动态计算
- 注意横屏/竖屏模式下坐标系的差异
- 动画状态管理：需要一个 `isAttacking` 状态防止重复触发
- 可复用 `Animated.Value` 控制火球的 x/y 坐标

## Design Considerations

- 火球视觉风格：卡通、可爱、明亮的橙黄色
- 火球大小：约 60-80px，在移动过程中保持大小不变
- 建议火球有轻微旋转或缩放脉动，增加动感（可选）

## Success Metrics

- 角色和怪物在 iPad 竖屏模式下完整可见，无遮挡
- 火球动画流畅，无卡顿（60fps）
- 玩家能明确感知"写对 → 攻击 → 命中"的因果关系
- 动画不影响游戏整体节奏

## Open Questions

- 火球是否需要轻微的旋转动画？
- 是否需要在火球飞行时添加简单的缩放效果（从小变大再变小）？
- 横屏模式下是否需要单独调整动画轨迹？

---

## Implementation Order

建议按以下顺序实现：

1. **US-001** - 先调整布局，确定角色最终位置
2. **US-002** - 生成火球素材
3. **US-003** - 实现火球飞行动画
4. **US-004** - 添加命中效果

预计工作量：2-3 小时
